<html>
  <head>
    <title>AR.js Basic Projected Camera Example</title>
    <script src="https://aframe.io/releases/1.0.4/aframe.min.js"></script>
    <script src="https://raw.githack.com/AR-js-org/AR.js/master/aframe/build/aframe-ar-nft.js"></script>
    <!-- Look-at component. We don't need this now, but we will later. -->
    <script src="https://unpkg.com/aframe-look-at-component@0.8.0/dist/aframe-look-at-component.min.js"></script>
    <style>
      body {
        min-height: 100vh;
        width: 100%;
        overflow: hidden;
      }
    </style>
    <script>
      AFRAME.registerComponent("camera-logger", {
        schema: {
          timestamp: { type: "int" },
          seconds: { type: "int" }, // default 0
        },

        log: function () {
          var cameraEl = this.el.sceneEl.camera.el;
          var rotation = cameraEl.getAttribute("rotation");
          var worldPos = new THREE.Vector3();
          worldPos.setFromMatrixPosition(cameraEl.object3D.matrixWorld);
          this.el.setAttribute(
            "position",
            `${worldPos.x} ${worldPos.y} ${worldPos.z}`
          );
          // console.log(
          //   "Time: " +
          //     this.data.seconds +
          //     "; Camera Position: (" +
          //     worldPos.x.toFixed(2) +
          //     ", " +
          //     worldPos.y.toFixed(2) +
          //     ", " +
          //     worldPos.z.toFixed(2) +
          //     "); Camera Rotation: (" +
          //     rotation.x.toFixed(2) +
          //     ", " +
          //     rotation.y.toFixed(2) +
          //     ", " +
          //     rotation.z.toFixed(2) +
          //     ")"
          // );
        },

        play: function () {
          this.data.timestamp = Date.now();
          this.log();
        },

        tick: function () {
          if (Date.now() - this.data.timestamp > 1000) {
            this.data.timestamp += 1000;
            this.data.seconds += 1;
            this.log();
          }
        },
      });
    </script>
  </head>
  <body>
    <audio
      id="themeSong"
      src="./assets/Sounds/theme_song.mp3"
      autoplay
      loop
    ></audio>
    <audio id="clickSound" src="./assets/Sounds/click_sound.mp3"></audio>

    <!-- Location Based Start  -->

    <!-- Location Based End  -->

    <!-- Position Based Start -->
    <a-scene embedded>
      <!-- <a-assets>
        <a-asset-item id="burgerModel" src="./assets/burger.glb"></a-asset-item>
        <a-asset-item
          id="panModel"
          src="./assets/pan_model/scene.gltf"
        ></a-asset-item>
        <a-asset-item
          id="tpaperModel"
          src="./assets/toiletPaper_model/glTF/scene.gltf"
        ></a-asset-item>
      </a-assets> -->

      <a-camera look-controls camera-logger>
        <a-entity
          cursor="fuse: false; rayOrigin: mouse;"
          position="0 0 -1"
          color="red"
          raycaster="objects: .rune"
          geometry="primitive: ring; radiusInner: 0.02;
radiusOuter: 0.03"
          material="color: black; shader: flat"
        >
        </a-entity>
      </a-camera>
      <!-- 
      <a-entity
        gltf-model="#burgerModel"
        id="box-red"
        class="rune"
        position="-10 4 -20"
        scale="3 3 3"
      ></a-entity>
      <a-entity
        id="box-yellow"
        gltf-model="#panModel"
        class="rune"
        position="-20 0.5 20"
        scale="50 30 50"
      ></a-entity>
      <a-entity
        id="box-blue"
        gltf-model="#tpaperModel"
        class="rune"
        position="-50 0.5 -20"
        scale="50 30 50"
      ></a-entity> -->
    </a-scene>
    <!-- Position Based End -->

    <script>
      const scene = document.querySelector("a-scene");
      const camera = document.querySelector("a-camera");

      const position = { x: 20, y: 10, z: -20 };
      let boxes;
      let color = ["red", "green", "yellow", "blue", "black"];
      let scale = { x: 30, y: 30, z: 30 };
      const clickSound = document.querySelector("#clickSound");
      window.onload = () => {
        //Generating 5 Elements at start
        for (let i = 0; i < 50; i++) {
          positionRandomizer(position);
          generateElement(scene, position, colorRandomizer(color), scale);
        }
        //Get all elements with rune class
        boxes = document.querySelectorAll(".rune");
        //This method adds click event for all boxes.
        onSpawn();
      };

      function logAcl() {
        let acl = new Accelerometer({ frequency: 60 });

        acl.addEventListener("reading", () => {
          console.log(acl.x);
        });
      }

      //On Click we start animation, remove the element from Dom and spawn new one.
      function onSpawn() {
        boxes.forEach((element) => {
          element.addEventListener("click", (e) => {
            element.setAttribute("animation", {
              property: "scale",
              to: "0.1 0.1 0.1",
              easing: "easeOutElastic",
              dur: 1000,
            });
            clickSound.play();

            setTimeout(() => {
              scene.removeChild(e.target);
              //Randomize the Position object
              positionRandomizer(position);
              //Generate new element with different position and color;
              generateElement(scene, position, colorRandomizer(color), scale);
              boxes = document.querySelectorAll(".rune");
              onSpawn();
            }, 1000);
          });
        });
      }

      //Helper function to generate new element
      function generateElement(_scene, position, color, scale) {
        const newBox = document.createElement("a-box");
        newBox.setAttribute("class", "rune");
        newBox.setAttribute("position", position);
        newBox.setAttribute("scale", scale);
        newBox.setAttribute("color", color);
        newBox.setAttribute("animation", {
          property: "rotation",
          to: "180 360 0",
          loop: true,
          dur: 10000,
        });
        _scene.appendChild(newBox);
      }

      function positionRandomizer(_positionObj) {
        _positionObj.x = generateRandomNum(600, true);
        _positionObj.y = generateRandomNum(300, true);
        _positionObj.z = generateRandomNum(600, true);
      }
      function colorRandomizer(elArray) {
        return elArray[generateRandomNum(elArray.length, false)];
      }

      //Helper function to generate random number
      function generateRandomNum(range, sign) {
        if (sign) {
          return Math.floor(Math.random() * (range - range * -1) + -1 * range);
        } else {
          return Math.floor(Math.random() * range);
        }
      }
    </script>
  </body>
</html>
